<div class="category-template">
  <h2>Druk A4/A3 + skan</h2>
  
  <!-- TRYB + FORMAT (bez zmian) -->
  <div class="form-row">
    <div class="form-group">
      <label>Tryb:</label>
      <select id="d-mode">
        <option value="bw">CzarnobiaÅ‚y</option>
        <option value="color">Kolorowy</option>
      </select>
    </div>
    <div class="form-group">
      <label>Format:</label>
      <select id="d-format">
        <option value="A4">A4</option>
        <option value="A3">A3</option>
      </select>
    </div>
  </div>

  <!-- DRUK + OPCJE (bez zmian) -->
  <div class="form-group">
    <label>IloÅ›Ä‡ stron do druku:</label>
    <input type="number" id="d-print-qty" min="0" value="1">
  </div>

  <div class="form-row">
    <div class="form-group">
      <label><input type="checkbox" id="d-email"> E-mail (1zÅ‚)</label>
    </div>
    <div class="form-group">
      <label><input type="checkbox" id="d-surcharge"> Zadruk >25% (+50%)</label>
    </div>
  </div>

  <!-- SKANOWANIE (bez zmian) -->
  <div class="form-group">
    <label>Rodzaj skanowania:</label>
    <select id="d-scan-type">
      <option value="none">Brak</option>
      <option value="auto">Automatyczne</option>
      <option value="manual">RÄ™czne z szyby</option>
    </select>
  </div>

  <div class="form-row" id="scan-qty-row" style="display:none;">
    <div class="form-group">
      <label>IloÅ›Ä‡ stron do skanowania:</label>
      <input type="number" id="d-scan-qty" min="0" value="1">
    </div>
  </div>

  <!-- PRZYCISKI + WYNIKI (bez zmian) -->
  <div class="form-row">
    <button id="d-calculate" class="btn-primary">Oblicz</button>
    <button id="d-add-to-cart" class="btn-secondary" disabled>Dodaj do listy</button>
  </div>

  <div id="d-result-display" style="display:none;">
    <div class="result-row">ğŸ’° Cena druku/str.: <span id="d-unit-print-price">-</span></div>
    <div class="result-row">ğŸ“„ CaÅ‚kowity druk: <span id="d-total-print-price">-</span></div>
    <div class="result-row" id="d-scan-row" style="display:none;">ğŸ“· Skanowanie: <span id="d-total-scan-price">-</span></div>
    <div class="result-row" id="d-email-row" style="display:none;">ğŸ“§ E-mail: <span id="d-email-price">-</span></div>
    <div class="result-row" id="d-surcharge-row" style="display:none;">ğŸ¨ DopÅ‚ata zadruk: <span id="d-surcharge-price">-</span></div>
    <hr>
    <div class="result-row total" style="font-size:1.4em; color:#28a745; font-weight:bold;">
      ğŸ’ **SUMA: <span id="d-total-price">-</span>**
    </div>
  </div>

  <!-- KOMPAKTOWY CENNÄ°K - DWA KOLUMNY -->
  <div class="pricing-compact" style="display: flex; gap: 24px; margin-top: 30px; font-family: Arial, sans-serif; font-size: 14px;">
    
    <!-- CZARNO-BIAÅY -->
    <div style="flex: 1; background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 5px solid #333;">
      <h4 style="color: #333; margin: 0 0 16px 0; font-size: 16px;">ğŸ–¨ï¸ Druk czarnobiaÅ‚y</h4>
      <div style="line-height: 1.6; color: #333;">
        <div><strong>A4:</strong> <span style="font-style: italic;">1-5: 0,90 zÅ‚</span> | <span style="font-style: italic;">6-20: 0,60 zÅ‚</span> | <span style="font-style: italic;">21+: 0,30 zÅ‚</span></div>
        <div style="margin-top: 8px;"><strong>A3:</strong> <span style="font-style: italic;">1-5: 1,70 zÅ‚</span> | <span style="font-style: italic;">6-20: 1,10 zÅ‚</span> | <span style="font-style: italic;">21+: 0,50 zÅ‚</span></div>
      </div>
    </div>

    <!-- KOLOROWY -->
    <div style="flex: 1; background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 5px solid #0066cc;">
      <h4 style="color: #0066cc; margin: 0 0 16px 0; font-size: 16px;">ğŸŒˆ Druk kolorowy</h4>
      <div style="line-height: 1.6; color: #333;">
        <div><strong>A4:</strong> <span style="font-style: italic;">1-10: 2,40 zÅ‚</span> | <span style="font-style: italic;">11-40: 2,20 zÅ‚</span> | <span style="font-style: italic;">41+: 1,80 zÅ‚</span></div>
        <div style="margin-top: 8px;"><strong>A3:</strong> <span style="font-style: italic;">1-10: 4,80 zÅ‚</span> | <span style="font-style: italic;">11-40: 4,20 zÅ‚</span> | <span style="font-style: italic;">41+: 3,50 zÅ‚</span></div>
      </div>
    </div>
  </div>

  <!-- SKANOWANIE + INFO -->
  <div style="display: flex; gap: 20px; margin-top: 20px; font-size: 13px;">
    <div style="flex: 1; background: #e3f2fd; padding: 16px; border-radius: 8px; color: #1976d2;">
      <strong>ğŸ“· Skanowanie auto:</strong> <span style="font-style: italic;">1-9: 1,00 zÅ‚</span> | <span style="font-style: italic;">10+: 0,40 zÅ‚</span>
    </div>
    <div style="flex: 1; background: #fff3cd; padding: 16px; border-radius: 8px; color: #856404;">
      <strong>âš ï¸ RÄ™czne:</strong> <span style="font-style: italic;">1-4: 2,00 zÅ‚</span> | <span style="font-style: italic;">5+: 1,00 zÅ‚</span><br>
      <small>E-mail: 1 zÅ‚ | Zadruk>25%: +50%</small>
    </div>
  </div>
</div>

<script>
document.getElementById('d-surcharge').addEventListener('change', function() {
  document.getElementById('surcharge-qty-row').style.display = this.checked ? 'flex' : 'none';
});

document.getElementById('d-scan-type').addEventListener('change', function() {
  document.getElementById('scan-qty-row').style.display = this.value !== 'none' ? 'flex' : 'none';
});

// UPROSZCZONY CENNÄ°K
const cenyDruk = {
  bw: {
    A4: [[5,0.90],[20,0.60],[Infinity,0.30]],
    A3: [[5,1.70],[20,1.10],[Infinity,0.50]]
  },
  color: {
    A4: [[10,2.40],[40,2.20],[Infinity,1.80]],
    A3: [[10,4.80],[40,4.20],[Infinity,3.50]]
  }
};

document.getElementById('d-calculate').addEventListener('click', function() {
  const mode = document.getElementById('d-mode').value;
  const format = document.getElementById('d-format').value;
  const printQty = parseInt(document.getElementById('d-print-qty').value) || 0;
  
  let unitPrintPrice = 0;
  if (printQty > 0) {
    for (let zakres of cenyDruk[mode][format]) {
      if (printQty <= zakres[0]) {
        unitPrintPrice = zakres[1];
        break;
      }
    }
  }
  
  const totalPrintPrice = (unitPrintPrice * printQty).toFixed(2);
  
  // Reszta obliczeÅ„ (skan, email, surcharge) BEZ ZMIAN
  const surchargeChecked = document.getElementById('d-surcharge').checked;
  let surchargePrice = 0;
  if (surchargeChecked) {
    const surchargeQty = parseInt(document.getElementById('d-surcharge-qty').value) || 0;
    surchargePrice = (unitPrintPrice * 0.5 * surchargeQty).toFixed(2);
  }
  
  const scanType = document.getElementById('d-scan-type').value;
  let scanPrice = 0;
  if (scanType !== 'none') {
    const scanQty = parseInt(document.getElementById('d-scan-qty').value) || 0;
    if (scanType === 'auto') {
      scanPrice = scanQty <= 9 ? 1.00 : 0.40;
    } else {
      scanPrice = scanQty <= 4 ? 2.00 : 1.00;
    }
    scanPrice *= scanQty;
    scanPrice = scanPrice.toFixed(2);
  }
  
  const emailChecked = document.getElementById('d-email').checked;
  const emailPrice = emailChecked ? '1.00' : '0.00';
  
  const total = (parseFloat(totalPrintPrice) + parseFloat(surchargePrice) + parseFloat(scanPrice) + parseFloat(emailPrice)).toFixed(2);
  
  // WyÅ›wietlanie
  document.getElementById('d-unit-print-price').textContent = unitPrintPrice.toFixed(2) + ' zÅ‚';
  document.getElementById('d-total-print-price').textContent = totalPrintPrice + ' zÅ‚';
  document.getElementById('d-total-scan-price').textContent = scanPrice + ' zÅ‚';
  document.getElementById('d-email-price').textContent = emailPrice + ' zÅ‚';
  document.getElementById('d-surcharge-price').textContent = surchargePrice + ' zÅ‚';
  document.getElementById('d-total-price').textContent = total.replace('.', ',') + ' zÅ‚';
  
  // Toggle wierszy
  document.getElementById('d-scan-row').style.display = scanPrice > 0 ? 'block' : 'none';
  document.getElementById('d-email-row').style.display = emailChecked ? 'block' : 'none';
  document.getElementById('d-surcharge-row').style.display = surchargeChecked ? 'block' : 'none';
  
  document.getElementById('d-result-display').style.display = 'block';
  document.querySelector('.total').scrollIntoView({ behavior: 'smooth' });
  
  document.getElementById('d-add-to-cart').disabled = totalPrintPrice <= 0;
});
</script>
